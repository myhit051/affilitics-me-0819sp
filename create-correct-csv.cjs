const fs = require('fs');

// Create a correctly formatted CSV file
const correctCSV = `รหัสการสั่งซื้อ,สถานะการสั่งซื้อ,เลขที่คำสั่งซื้อ,เวลาที่สั่งซื้อ,เวลาที่สั่งซื้อสำเร็จ,เวลาคลิก,ชื่อร้านค้า,ID ร้านค้า,ประเภทของร้านค้า,รหัสรายการสินค้า,ชื่อรายการสินค้า,เลขที่ โมเดล,ประเภทสินค้า,เลขที่โปรโมชั่น,L1 หมวดหมู่สากล,L2 หมวดหมู่สากล,L3 หมวดหมู่สากล,ราคา(฿),จำนวน,ประเภทข้อเสนอ,พาร์ทเนอร์ในแคมเปญ,มูลค่าซื้อ(฿),จำนวนเงินคืน(฿),อัตราคอมมิชชั่นช้อปปี้ของสินค้า,ค่าคอมมิชชั่นของช้อปปี้ต่อชิ้น(฿),อัตราคอมมิชชั่นร้านค้าของสินค้า,ค่าคอมมิชชั่นของแบรนด์์ต่อชิ้น(฿),คอมมิชชั่นสินค้าโดยรวม(฿),คอมมิชชั่นคำสั่งซื้อจาก Shopee(฿),คอมมิชชั่นคำสั่งซื้อจากผู้ขาย(฿),คอมมิชชั่นคำสั่งซื้อโดยรวม(฿),ชื่อ MCN ที่ผูกไว้,รหัสสัญญา MCN,อัตราค่าบริการ MCN,ค่าบริการ MCN(฿),อัตราค่าคอมมิชชั่นของพาร์ทเนอร์ตามข้อตกลง,ค่าคอมมิชชั่นสุทธิ(฿),สถานะสินค้า Affiliate,หมายเหตุสินค้า,ประเภทการแจกจ่าย,สถานะของผู้ซื้อ,Sub_id1,Sub_id2,Sub_id3,Sub_id4,Sub_id5,ช่องทาง
2508197AGC7HY0,รอดำเนินการ,209251805284469,2025-08-19 04:30:06,,2025-08-18 23:38:38,Moses Official Mall,391506896,Preferred(Non-CB),23787185049,กระจกยาว กระจกเต็มตัว หอพักนักศึกษา กระจกอะคริลิก แบบติดผนัง ขายเป็นแผ่น จะไม่แตก กระจกห้องน้ำ,255052859558,Normal Product,,เครื่องใช้ในบ้าน,อุปกรณ์ตกแต่งบ้าน,กระจก,50,1,คอมมิชชั่นจากร้านค้า,,50,,1.50%,0.75,7.00%,0,0.75,0.75,0,0.75,,0,0.00%,0,100.00%,0.75,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,39184846,tunis,mng,m39True1215,,Websites
25081973K4529T,รอดำเนินการ,209244381280284,2025-08-19 02:26:21,,2025-08-18 07:18:02,YW-GO,373563293,C2C(Non-CB),26935549565,40/100แผ่น กระดาษกรองกาแฟ รูปทรงV กระดาษดริป กรองกาแฟ กระดาษกรองกาแฟวงกลมCF18,248344442047,Normal Product,,เครื่องใช้ในบ้าน,เครื่องครัว,อุปกรณ์ทำกาแฟ,48,1,คอมมิชชั่นจาก Shopee,,46,,1.50%,0.69,0.00%,0,0.69,0.69,0,0.69,,0,0.00%,0,100.00%,0.69,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,m39Shirtcat1127,tunis,mng,,,Websites
2508196YUQPK2Y,รอดำเนินการ,209240375257530,2025-08-19 01:19:35,,2025-08-18 23:37:01,กินเพลิน ขนมแปรรูป,26566365,C2C(Non-CB),10394889597,กินเพลิน ส่งไว|ถูก✨ อาลัว อาลัวจิ๋ว อาลัวหวานน้อย อาลัวดอกไม้ อาลัวชาววัง อาลัวสายรุ้ง อาลัวปลาทู อาลัวดอกบัว อาลัวใหญ่,154259187990,Normal Product,,อาหารและเครื่องดื่ม,เบเกอรี่,ขนมอบ,65,1,คอมมิชชั่นจาก Shopee,,50,,1.75%,0.875,0.00%,0,0.875,0.875,0,0.875,,0,0.00%,0,100.00%,0.875,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,33732471,tunis,mng,m39Gaviscon0117,,Websites
2508196Y4ETUP1,รอดำเนินการ,209239594204775,2025-08-19 01:06:34,,2025-08-17 10:09:20,Best Case SHOP,1030208294,Preferred(Non-CB),24181723233,VIVO Y20 Y21 Y33S Y33T Y36 Y50 Y30 Y95 Y91C Y15S Y02 Y02T Y12S Y16 Y17 Y15 Y12 Y17S Y27S V25 V27 V29 5G เคสวีโว่ XMK,215151844196,Normal Product,,มือถือและอุปกรณ์เสริม,อุปกรณ์เสริม,เคสมือถือและแท็บเล็ต,29,1,คอมมิชชั่นจากร้านค้า,,28,,1.50%,0.42,3.00%,0,0.42,0.42,0,0.42,,0,0.00%,0,100.00%,0.42,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,2588adboostco,paris,mng,m01KFdika0520,,Facebook
2508196VFRJF6N,รอดำเนินการ,209236752285226,2025-08-19 00:19:12,,2025-08-18 20:21:54,sunshine.shopp,296542803,C2C(Non-CB),28716557243,กำยานสปา กำยานหอม จุดบูชาเทพ กลิ่นดอกไม้ #AC-0002,157538095905,Normal Product,,เครื่องใช้ในบ้าน,เทียนหอม และน้ำมันหอมระเหย,อื่นๆ,18,1,คอมมิชชั่นจากร้านค้า,,14,,1.50%,0.21,7.00%,0,0.21,0.63,0,0.63,,0,0.00%,0,100.00%,0.63,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508196VFRJF6N,รอดำเนินการ,209236752285226,2025-08-19 00:19:12,,2025-08-18 20:21:54,sunshine.shopp,296542803,C2C(Non-CB),28716557243,กำยานสปา กำยานหอม จุดบูชาเทพ กลิ่นดอกไม้ #AC-0002,157538095909,Normal Product,,เครื่องใช้ในบ้าน,เทียนหอม และน้ำมันหอมระเหย,อื่นๆ,18,1,คอมมิชชั่นจากร้านค้า,,14,,1.50%,0.21,7.00%,0,0.21,0,0,0,,0,0.00%,0,100.00%,0,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508196VFRJF6N,รอดำเนินการ,209236752285226,2025-08-19 00:19:12,,2025-08-18 20:21:54,sunshine.shopp,296542803,C2C(Non-CB),28716557243,กำยานสปา กำยานหอม จุดบูชาเทพ กลิ่นดอกไม้ #AC-0002,157538095910,Normal Product,,เครื่องใช้ในบ้าน,เทียนหอม และน้ำมันหอมระเหย,อื่นๆ,18,1,คอมมิชชั่นจากร้านค้า,,14,,1.50%,0.21,7.00%,0,0.21,0,0,0,,0,0.00%,0,100.00%,0,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508196TWGMSH9,รอดำเนินการ,209235066253656,2025-08-18 23:51:06,,2025-08-18 20:00:13,ORANGE.Wheels,102891797,Preferred(Non-CB),22680258965,"GOODRIDE (ยาง1เส้น) ขายดี 175/65R14 185/65R14 175/65R15 185/55R15 185/60R15 185/65R15 195/55R15 195/60R15",147366905370,Normal Product,,รถยนต์ อะไหล่และอุปกรณ์เสริมรถยนต์,ชิ้นส่วนอะไหล่รถยนต์,ยางรถและอุปกรณ์เสริม,1320,2,คอมมิชชั่นจาก Shopee,,2376,,1.75%,41.58,0.00%,0,41.58,41.58,0,41.58,,0,0.00%,0,100.00%,41.58,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,37492180,tunis,mng,m39GOODRIDESportRS0116,,Websites
2508196SUEK2W4,รอดำเนินการ,209233923253866,2025-08-18 23:32:03,,2025-08-18 21:33:53,dktoday,204155689,C2C(Non-CB),5217012062,DKTODAY หนังสือ ENGLISH GRAMMAR IN USE WITH ANS (5ED) เวอร์ชั่นใหม่ล่าสุด,72155540376,Normal Product,,หนังสือและนิตยสาร,หนังสือ,หนังสือภาษาและพจนานุกรม,599,1,คอมมิชชั่นจาก Shopee,,599,,1.50%,8.985,0.00%,0,8.985,8.985,0,8.985,,0,0.00%,0,100.00%,8.985,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508196SG2AP0B,รอดำเนินการ,209233541292168,2025-08-18 23:25:41,,2025-08-17 21:31:51,ชัยเจริญยนต์,275386060,C2C(Non-CB),28935350432,ยางนอกรถสามล้อบรรทุกจีน ขนาด4.00-12 / 4.50-12,253328165316,Normal Product,,รถมอเตอร์ไซค์ อะไหล่และอุปกรณ์เสริมมอเตอร์ไซค์,อื่นๆ,,930,2,คอมมิชชั่นจาก Shopee,,1466,,1.75%,25.655,0.00%,0,25.655,25.655,0,25.655,,0,0.00%,0,100.00%,25.655,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0706,,Facebook
2508184JYC5T92,ยกเลิก,209157819265316,2025-08-18 02:23:46,--,2025-08-18 02:17:56,girlpajamasx5.th,1333199214,C2C(CB),28265051525,ชุดนอนผู้หญิงน่ารักกระต่ายแขนยาวกางเกงตุ๊กตาปกหลวม ชุดลําลอง ชุดสามารถสวมใส่นอก,256848552094,Normal Product,,เสื้อผ้าผู้หญิง,ชุดนอน,ชุดนอน,66,0,คอมมิชชั่นจาก Shopee,,0,58,1.50%,0,0.00%,0,0,0,0,0,,0,0.00%,0,100.00%,0,ยกเลิก,คำสั่งซื้อถูกยกเลิก เนื่องจากการจัดส่งไม่สำเร็จ.,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508184JQUSF2W,รอดำเนินการ,209157567200549,2025-08-18 02:19:27,,2025-08-17 17:41:27,superwheyshop,2080411,Preferred(Non-CB),27610810837,Reewa รีว่า-เคราติน บำรุงผม ลดการชี้ฟู ผมสุขภาพดีขึ้น ปริมาณ 100 ml.,167052500452,Normal Product,,ผลิตภัณฑ์บำรุงและเสริมความงาม,ผลิตภัณฑ์ดูแลผม,ทรีทเม้นท์บำรุงเส้นผม,155,1,คอมมิชชั่นจาก Shopee,,139,,1.75%,2.4325,0.00%,0,2.4325,2.4325,0,2.4325,,0,0.00%,0,100.00%,2.4325,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508184JEEDTEU,สำเร็จ,209157251206898,2025-08-18 02:14:11,2025-08-19 11:02:51,2025-08-18 02:13:30,GQ Outlet,168932539,Shopee Mall(Non-CB),13005823462,"[ลด 1000.-] GQ Everyday Trouser กางเกงทำงานผ้า Smooth Poly ผ้าทนการใช้งาน ดูแพง มี 2 ทรง Slim กับ Tailored",256329021821,Normal Product,,เสื้อผ้าผู้ชาย,กางเกงขายาว,กางเกงขายาว,590,1,คอมมิชชั่นจากร้านค้า,,395,,1.75%,6.9125,15.00%,59.25,66.1625,6.9125,59.25,66.1625,,0,0.00%,0,100.00%,66.1625,สำเร็จ,,สั่งซื้อในร้านค้าเดียวกัน,ที่มีอยู่,30444549,tunis,mng,m39gq0903,,Websites
2508184E6B0RV4,รอดำเนินการ,209152684224473,2025-08-18 00:58:04,,2025-08-18 00:45:29,ICCSHOPPING,170139972,Shopee Mall(Non-CB),3112272145,ARROW LITE กางเกงใน รูปแบบ BOXER สีดำ,7587837577,Normal Product,,เสื้อผ้าผู้ชาย,ชุดชั้นในชาย,กางเกงใน,99,3,คอมมิชชั่นจากร้านค้า,,238,,1.75%,4.165,8.00%,0,4.165,8.295,0,8.295,,0,0.00%,0,100.00%,8.295,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508184E6B0RV4,รอดำเนินการ,209152684224473,2025-08-18 00:58:04,,2025-08-18 00:45:29,ICCSHOPPING,170139972,Shopee Mall(Non-CB),3112274449,ARROW LITE กางเกงใน รูปแบบ BOXER สีเทา,7587960413,Normal Product,,เสื้อผ้าผู้ชาย,ชุดชั้นในชาย,กางเกงใน,99,3,คอมมิชชั่นจากร้านค้า,,236,,1.75%,4.13,8.00%,0,4.13,0,0,0,,0,0.00%,0,100.00%,0,รอดำเนินการ,สถานะของสินค้านี้คือ อยู่ระหว่างดำเนินการ คอมมิชชั่นจะถูกคำนวณเพื่อจ่ายหลังสถานะเป็นสำเร็จแล้วเท่านั้น,คำสั่งซื้อจากร้านค้าต่างกัน,ที่มีอยู่,MOAUG25,paris,mng,m02Rooftop0623,,Facebook
2508184B8Y565T,ยกเลิก,209149551224548,2025-08-18 00:05:50,--,2025-08-17 00:01:49,TUWOSHOPE,919008636,Shopee Mall(Non-CB),26017171611,TUWO 2025รุ่นใหม่ล่าสุด 66Wแบตสำรอง เพาเวอร์แบงค์ Powerbank 20000mAh ชาร์จเร็ว เบาและเร็ว ของใช้ในการเดินทาง,217959372442,Normal Product,,มือถือและอุปกรณ์เสริม,อุปกรณ์เสริม,แบตเตอรี่และแบตสำรอง,259,0,คอมมิชชั่นจากร้านค้า,,0,233,1.00%,0,9.00%,0,0,0,0,0,,0,0.00%,0,100.00%,0,ยกเลิก,ผู้ซื้อยกเลิกคำสั่งซื้อ.,สั่งซื้อในร้านค้าเดียวกัน,ที่มีอยู่,,,,,,Shopeevideo-Shopee`;

// Write the correct CSV file
fs.writeFileSync('test file/10or-correct.csv', correctCSV, 'utf8');

console.log('✅ Correct CSV file created: test file/10or-correct.csv');

// Test the correct CSV file
const csv = require('csv-parser');
const orders = [];

fs.createReadStream('test file/10or-correct.csv')
  .pipe(csv())
  .on('data', (row) => {
    orders.push(row);
  })
  .on('end', () => {
    console.log('\n=== TESTING CORRECT CSV ===');
    console.log(`Total orders: ${orders.length}`);
    
    // Check problematic orders
    const order1 = orders.find(o => o['รหัสการสั่งซื้อ'] === '2508196TWGMSH9');
    const order2 = orders.find(o => o['รหัสการสั่งซื้อ'] === '2508184JEEDTEU');
    
    if (order1) {
      console.log('\n📋 Order 2508196TWGMSH9:');
      console.log('  Commission:', order1['คอมมิชชั่นสินค้าโดยรวม(฿)']);
      console.log('  Status:', order1['สถานะสินค้า Affiliate']);
      console.log('  Sub_id1:', order1['Sub_id1']);
      console.log('  Channel:', order1['ช่องทาง']);
    }
    
    if (order2) {
      console.log('\n📋 Order 2508184JEEDTEU:');
      console.log('  Commission:', order2['คอมมิชชั่นสินค้าโดยรวม(฿)']);
      console.log('  Status:', order2['สถานะสินค้า Affiliate']);
      console.log('  Sub_id1:', order2['Sub_id1']);
      console.log('  Channel:', order2['ช่องทาง']);
    }
    
    // Calculate total commission
    const totalCommission = orders.reduce((sum, order) => {
      return sum + parseFloat(order['คอมมิชชั่นสินค้าโดยรวม(฿)'] || '0');
    }, 0);
    
    console.log(`\n=== TOTAL COMMISSION ===`);
    console.log(`Total: ${totalCommission} ฿`);
    
    console.log('\n✅ CSV file is now correct! Use this file for testing.');
  });
